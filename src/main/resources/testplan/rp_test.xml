<?xml version="1.0" encoding="UTF-8"?>
<TestPlan xmlns="http://nds.rub.de/oidc/test-model"
          Name="RP-Test-Plan">

    <LearningStep Name="LearningStep">
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.RPLearningBrowser</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-2>
    </LearningStep>

    <TestStep Name="ID Spoofing 1">
        <Description><![CDATA[
			<h1>ID Spoofing Attack</h1>
            In this test we use the Attacker OP and create an ID Token containing the identity of the victim, which is controlled by another OP– Honest OP.

            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.  The attack needs additional configuration parameters:

	    <h2>Execution.</h2>
	    The OPIV issues invalid ID token containing victim's identity in the "sub".

            <h2>Result Evaluation.</h2>
            The test is successful if the code or token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.IDSpoofingOP</ImplementationClass>

            <!-- gets the "sub" configured in the Honest OP" -->
            <Parameter key="idtoken_sub">de.rub.nds.oidc.server.op.DefaultOP.IDToken.subject</Parameter>
        </OPConfig-2>
    </TestStep>

    <TestStep Name="ID Spoofing 2">
        <Description><![CDATA[
			<h1>ID Spoofing Attack</h1>
            In this test we use the Attacker OP and create an ID Token containing the identity of the victim, which is controlled by another OP– Honest OP.

            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.  The attack needs additional configuration parameters:

	    <h2>Execution.</h2>
	    The OPIV issues invalid ID token containing victim's identity in the "sub" and the Honest OP as "iss".

            <h2>Result Evaluation.</h2>
            The test is successful if the code or token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.IDSpoofingOP</ImplementationClass>

            <!-- gets the "iss" and "sub" configured in the Honest OP" -->
            <Parameter key="idtoken_iss">de.rub.nds.oidc.server.op.DefaultOP.issuer</Parameter>
            <Parameter key="idtoken_sub">de.rub.nds.oidc.server.op.DefaultOP.IDToken.subject</Parameter>
        </OPConfig-2>
    </TestStep>

    <TestStep Name="ID Spoofing 3">
        <Description><![CDATA[
			<h1>ID Spoofing Attack</h1>
            In this test we use the Attacker OP and create an ID Token containing the identity of the victim, which is controlled by another OP– Honest OP.

            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.  The attack needs additional configuration parameters:

	    <h2>Execution.</h2>
	    The OPIV issues valid ID token containing victim's identity as subclaims.

            <h2>Result Evaluation.</h2>
            The test is successful if the code or token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.IDSpoofingOP</ImplementationClass>
            <!-- gets the "name", "username" and "email" configured in the Honest OP" -->
            <Parameter key="idtoken_name">de.rub.nds.oidc.server.op.DefaultOP.IDToken.name</Parameter>
            <Parameter key="idtoken_username">de.rub.nds.oidc.server.op.DefaultOP.IDToken.username</Parameter>
            <Parameter key="idtoken_email">de.rub.nds.oidc.server.op.DefaultOP.IDToken.email</Parameter>
        </OPConfig-2>
    </TestStep>

    <TestStep Name="Issuer Confusion">
        <Description><![CDATA[
			<h1>Issuer Confusion</h1>
            In this test we use the Attacker OP to return maliciously crafted Discovery document and afterwards to create an ID Token containing the identity of the victim, which is controlled by another OP – Honest OP.

            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow. The attack needs additional configuration parameters: subject and issuer

	    <h2>Execution.</h2>
	    The OPIV returns invalid "issuer" parameters during Discovery.

            <h2>Result Evaluation.</h2>
            The test is successful if the code or token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">true</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.IssuerConfusionOP</ImplementationClass>
            <Parameter key="discovery_issuer">de.rub.nds.oidc.server.op.DefaultOP.issuer</Parameter>
            <Parameter key="idtoken_issuer">de.rub.nds.oidc.server.op.DefaultOP.issuer</Parameter>
            <Parameter key="idtoken_issuer">de.rub.nds.oidc.server.op.DefaultOP.IDToken.subject</Parameter>
        </OPConfig-2>
    </TestStep>

    <TestStep Name="Key Confusion 1 (future work)">
        <Description><![CDATA[
			<h1>Key Confusion</h1>
            
            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
	    <h2>Execution.</h2>
	    The OPIV issues an ID token containing valid signature signed with untrusted key.

            <h2>Result Evaluation.</h2>
            The test is successful if the token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.KeyConfusionOP</ImplementationClass>
			
            <Parameter key="idtoken_header_kid">url_to_untrusted_key</Parameter>
        </OPConfig-2>
    </TestStep>

    <TestStep Name="Key Confusion 2 (future work)">
        <Description><![CDATA[
			<h1>Key Confusion</h1>
            
            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
	    <h2>Execution.</h2>
	    The OPIV issues an ID token containing valid signature signed with untrusted key.

            <h2>Result Evaluation.</h2>
            The test is successful if the token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.KeyConfusionOP</ImplementationClass>
			
            <Parameter key="idtoken_header_kid">url_to_untrusted_key</Parameter>
        </OPConfig-2>
    </TestStep>

    <TestStep Name="Key Confusion 3 (future work)">
        <Description><![CDATA[
			<h1>Key Confusion</h1>
            
            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
	    <h2>Execution.</h2>
	    The OPIV issues an ID token containing valid signature signed with untrusted key.

            <h2>Result Evaluation.</h2>
            The test is successful if the token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.KeyConfusionOP</ImplementationClass>
			
            <Parameter key="idtoken_header_x5u">untrusted certificate</Parameter>
        </OPConfig-2>
    </TestStep>

    <TestStep Name="Key Confusion 4 (future work)">
        <Description><![CDATA[
			<h1>Key Confusion</h1>
            
            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
	    <h2>Execution.</h2>
	    The OPIV issues an ID token containing valid signature signed with untrusted key.

            <h2>Result Evaluation.</h2>
            The test is successful if the token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.KeyConfusionOP</ImplementationClass>
			
            <Parameter key="idtoken_header_x5c">untrusted certificate</Parameter>
        </OPConfig-2>
    </TestStep>

    <TestStep Name="Key Confusion 5 (future work)">
        <Description><![CDATA[
			<h1>Key Confusion</h1>
            
            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
	    <h2>Execution.</h2>
	    The OPIV issues an ID token containing valid signature signed with untrusted key.

            <h2>Result Evaluation.</h2>
            The test is successful if the token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.KeyConfusionOP</ImplementationClass>
			
            <Parameter key="idtoken_header_jku">untrusted certificate</Parameter>
        </OPConfig-2>
    </TestStep>

    <TestStep Name="Key Confusion 6 (future work)">
        <Description><![CDATA[
			<h1>Key Confusion</h1>
            
            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
	    <h2>Execution.</h2>
	    The OPIV issues an ID token containing valid signature signed with untrusted key.

            <h2>Result Evaluation.</h2>
            The test is successful if the token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.KeyConfusionOP</ImplementationClass>
			
            <Parameter key="idtoken_header_jwk">untrusted key</Parameter>
        </OPConfig-2>
    </TestStep>


    <TestStep Name="Key Confusion 7 ">
        <Description><![CDATA[
			<h1>Key Confusion</h1>
            
            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
	    <h2>Execution.</h2>
	    The OPIV issues an ID token containing valid signature signed with untrusted key.

            <h2>Result Evaluation.</h2>
            The test is successful if the token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <Parameter key="registration_clientid">de.rub.nds.oidc.server.op.DefaultOP.IDToken.audience</Parameter>
		  
            <ImplementationClass>de.rub.nds.oidc.server.op.KeyConfusionOP</ImplementationClass>
			
            <!-- starts authentication with Malicious OP -->
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.MaliciousOPBrowserSimulator</BrowserSimulatorClass>
			
            <!-- timeout before sending the Authentication Response (code or idtoken/access token) -->
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.MaliciousOP.AuthenticationRequest.timeout.start</BrowserSimulatorClass>
			
            <!-- starts authentication with Honest OP -->
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
			
            <!-- stops the timeout on the honest OP and sends the Authentication Response (code or idtoken/access token) -->
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.MaliciousOP.AuthenticationRequest.timeout.stop</BrowserSimulatorClass>
			
            <Parameter key="idtoken_header_alg">HS256</Parameter>
            <Parameter key="idtoken_iss">de.rub.nds.oidc.server.op.DefaultOP.issuer</Parameter>
            <Parameter key="idtoken_sub">de.rub.nds.oidc.server.op.DefaultOP.IDToken.subject</Parameter>
            <Parameter key="idtoken_aud">de.rub.nds.oidc.server.op.DefaultOP.IDToken.audience</Parameter>
        </OPConfig-2>
    </TestStep>

    <TestStep Name="MaliciousEntpointAttack">
        <Description><![CDATA[
			<h1>Malicious Endpoint Attacks</h1>
            In this test we use the Attacker OP to return maliciously crafted Discovery document and afterwards to create an ID Token containing the identity of the victim, which is controlled by another OP – Honest OP.
            
            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
            <h2>Execution.</h2> 
            The Attacker OP returns the following configuration during the Discovery phase.
            <pre>
             {
                "issuer": "https://opivAttackerOP.com",
                "registration_endpoint": "https://opivHonestOP.com/register",
                "authorization_endpoint": "https://opivHonestOP.com/auth",
                "token_endpoint": "https://opivAttackerOP.com/token",
                "userinfo_endpoint": "https://opivAttackerOP.com/userinfo"
                ...
             }
            </pre>            

            <h2>What happens if no discovery is supported?</h2>

            <h2>Result Evaluation.</h2>
            The goal of this test is to verify whether the End-User authentication can
            be broken. The test is successful if the Attacker OP receives any secret information, for example,
            client_id, client_secret,code or access token, generated by the Honest OP.
            Injection and DoS attacks are considered out of scope for the tests provided by OPIV.

		]]>
            <Parameter key="discovery_support_needed">true</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">true</Parameter>	
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.MaliciousEndpointOP</ImplementationClass>
					
            <Parameter key="discovery_issuer">de.rub.nds.oidc.server.op.MaliciousEndpointOP.issuer</Parameter>
            <Parameter key="discovery_registrationEP">de.rub.nds.oidc.server.op.DefaultOP.registrationEndpoint</Parameter>
            <Parameter key="discovery_authorizationEP">de.rub.nds.oidc.server.op.DefaultOP.authEndpoint</Parameter>
            <Parameter key="discovery_tokenEP">de.rub.nds.oidc.server.op.MaliciousEndpointOP.token</Parameter>
            <Parameter key="discovery_userinfoEP">de.rub.nds.oidc.server.op.MaliciousEndpointOP.token</Parameter>
        </OPConfig-2>
    </TestStep>

    <TestStep Name="ReplayAttack_1">
        <Description><![CDATA[
			<h1>Replay Attack</h1>
            
            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
	    <h2>Execution.</h2>
	    The OPIV issues an ID token containing expired "exp" timestamp.

            <h2>Result Evaluation.</h2>
            The test is successful if the token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.ReplayOP</ImplementationClass>
            <Parameter key="idtoken_exp">-1d</Parameter>
        </OPConfig-2>
    </TestStep>
    <TestStep Name="ReplayAttack_2">
        <Description><![CDATA[
			<h1>Replay Attack</h1>
            
            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
	    <h2>Execution.</h2>
	    The OPIV issues an ID token containing invalid "iat" timestamp.

            <h2>Result Evaluation.</h2>
            The test is successful if the token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.ReplayOP</ImplementationClass>
            <Parameter key="idtoken_iat">+1d</Parameter>
        </OPConfig-2>
    </TestStep>
    <TestStep Name="ReplayAttack_3">
        <Description><![CDATA[
			<h1>Replay Attack</h1>
            
            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
	    <h2>Execution.</h2>
	    The OPIV issues an ID token containing constant “nonce” value.

            <h2>Result Evaluation.</h2>
            The test is successful if the token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.ReplayOP</ImplementationClass>
            <Parameter key="idtoken_nonce">staticNonceValue</Parameter>
        </OPConfig-2>
    </TestStep>
    <TestStep Name="ReplayAttack_4">
        <Description><![CDATA[
			<h1>Replay Attack</h1>
            
            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
	    <h2>Execution.</h2>
	    The OPIV issues an ID token without a “nonce” parameter.

            <h2>Result Evaluation.</h2>
            The test is successful if the token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.ReplayOP</ImplementationClass>
			
            <Parameter key="idtoken_nonce"></Parameter> <!-- Missing nonce parameter -->
        </OPConfig-2>
    </TestStep>

    <TestStep Name="Session Overwriting">
        <Description><![CDATA[
			<h1>Session Overwriting</h1>
            
            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
	    <h2>Execution.</h2>
	    The Session Overwriting test consists of three steps and requires the participation of the Attacker OP and the Honest OP.


            <h2>Result Evaluation.</h2>
            The test is successful if the token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">true</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.SessionOverwritingOP</ImplementationClass>
			
            <!-- starts authentication with Honest OP -->
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
            <!-- timeout before sending the Authentication Response (code or idtoken/access token) -->
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOP.AuthenticationRequest.timeout.start</BrowserSimulatorClass>
			
            <!-- starts authentication with Malicious OP -->
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.MaliciousOPBrowserSimulator</BrowserSimulatorClass>
			
            <!-- stops the timeout on the honest OP and sends the Authentication Response (code or idtoken/access token) -->
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOP.AuthenticationRequest.timeout.stop</BrowserSimulatorClass>
        </OPConfig-2>
    </TestStep>

    <TestStep Name="Signature Manipulation 1">
        <Description><![CDATA[
			<h1>Signature Manipulation</h1>
            
            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
	    <h2>Execution.</h2>
	    The OPIV issues an ID token containing wrong signature.

            <h2>Result Evaluation.</h2>
            The test is successful if the token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.SignatureManipulationOP</ImplementationClass>
            <Parameter key="idtoken_signature">aW52YWxpZFNpZ25hdXJl</Parameter>
        </OPConfig-2>
    </TestStep>

    <TestStep Name="Signature Manipulation 2">
        <Description><![CDATA[
			<h1>Signature Manipulation</h1>
            
            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
	    <h2>Execution.</h2>
	    The OPIV issues an ID token containing invalid signature and "none" alogirthm.

            <h2>Result Evaluation.</h2>
            The test is successful if the token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.SignatureManipulationOP</ImplementationClass>
			
            <Parameter key="idtoken_header_alg">none</Parameter>
            <Parameter key="idtoken_signature">aW52YWxpZFNpZ25hdXJl</Parameter>
        </OPConfig-2>
    </TestStep>

    <TestStep Name="CSRF">
        <Description><![CDATA[
			<h1>CSRF Protection via the “state” parameter</h1>
            The OPIV tests the Validation of the "state" parameter on the Client.

            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
	    <h2>Execution.</h2>
	    The OPIV returns invalid "state" parameter.

            <h2>Result Evaluation.</h2>
            The test is successful if the code or token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.invalidStateOP</ImplementationClass>
			
            <Parameter key="state">invalid state</Parameter>
        </OPConfig-2>
    </TestStep>

    <TestStep Name="CSRF 2">
        <Description><![CDATA[
			<h1>CSRF Protection via the “state” parameter</h1>
            The OPIV tests the Validation of the "state" parameter on the Client.

            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
	    <h2>Execution.</h2>
	    The OPIV returns "state" parameter issued within another browser session.

            <h2>Result Evaluation.</h2>
            The test is successful if the code or token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.invalidStateOP</ImplementationClass>
			
            <!-- Starts the browser, initiates the authentication with the MaliciousOP and gets the received state parameter -->
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.MaliciousOPBrowserSimulator</BrowserSimulatorClass>
            <!-- Uses the received "state" parameter in a new browser session -->
            <Parameter key="state">de.rub.nds.oidc.browser.MaliciousOP.AuthenticationRequest.stateParameter</Parameter>
        </OPConfig-2>
    </TestStep>

    <TestStep Name="TRC 1">
        <Description><![CDATA[
			<h1>Token Recipient Confusion Attack</h1>
            The OPIV tests the Validation of the “audience” parameter on the Client by issuing maliciously crafted ID tokens.

            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
	    <h2>Execution.</h2>
	    The OPIV issues an ID token,which does not contain an "audience" parameter.

            <h2>Result Evaluation.</h2>
            The test is successful if the token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.trcOP</ImplementationClass>
			
            <Parameter key="idtoken_aud"></Parameter>
        </OPConfig-2>
    </TestStep>

    <TestStep Name="TRC 2">
        <Description><![CDATA[
			<h1>Token Recipient Confusion Attack</h1>
            The OPIV tests the Validation of the “audience” parameter on the Client by issuing maliciously crafted ID tokens.

            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
	    <h2>Execution.</h2>
	    The OPIV issues an ID token,which contains invalid "aud" parameter.

            <h2>Result Evaluation.</h2>
            The test is successful if the token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.trcOP</ImplementationClass>
			
            <Parameter key="idtoken_aud">invalidClient</Parameter>
        </OPConfig-2>
    </TestStep>


    <TestStep Name="TRC 2">
        <Description><![CDATA[
			<h1>Token Recipient Confusion Attack</h1>
            The OPIV tests the Validation of the “audience” parameter on the Client by issuing maliciously crafted ID tokens.

            <h2>Prerequisites.</h2>
            The target Client supports the implicit or the code flow.
	    <h2>Execution.</h2>
	    The OPIV issues an ID token,which contains invalid "aud" parameter.

            <h2>Result Evaluation.</h2>
            The test is successful if the token is accepted by the Client.
		]]>
            <Parameter key="discovery_support_needed">false</Parameter>
            <Parameter key="dynamic_client_registratiron_support_needed">false</Parameter>
        </Description>
        <SeleniumScript>
            <BrowserSimulatorClass>de.rub.nds.oidc.browser.DefaultOPBrowserSimulator</BrowserSimulatorClass>
        </SeleniumScript>
        <OPConfig-1>
            <ImplementationClass>de.rub.nds.oidc.server.op.DefaultOP</ImplementationClass>
        </OPConfig-1>
        <OPConfig-2>
            <ImplementationClass>de.rub.nds.oidc.server.op.trcOP</ImplementationClass>
			
            <Parameter key="idtoken_aud">de.rub.nds.oidc.server.op.DefaultOP.IDToken.audience</Parameter>
        </OPConfig-2>
    </TestStep>

</TestPlan> 
